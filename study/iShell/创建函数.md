# 创建函数

*来源： Linux命令行与shell脚本编程大全*

**内容**

>- 基本的脚本函数
>- 返回值
>- 在函数中使用变量
>- 数组变量和函数
>- 函数递归
>- 创建库
>- 在命令行上使用函数



我们可以将shell脚本代码放进函数中封装起来，这样就能在脚本中的任何地方多次使用它了。

下面我们来逐步了解如何创建自己的shell脚本函数并在应用中使用它们。

## 基本的脚本函数

函数是一个脚本代码块，我们可以为其命名并在代码中任何位置重用。要在脚本中使用该代码块，只要使用所起的函数名就行了。

### 创建函数

有两种格式可以创建函数。第一种格式是使用关键字`function`，后跟分配给该代码块的函数名。

```shell
funtion name{
	commands
}
```

`name`属性定义了赋予函数的唯一名称，`commands`是构成函数的一条或多条bash shell命令。

第二种格式更接近其他编程语言中定义函数的方式：

```shell
name(){
  commands
}
```

### 使用函数

要使用函数，只需要像其他shell命令一样，在行中指定函数名就行了。

```shell
wsx@wsx:~/tmp$ cat test1
#!/bin/bash
# using a function in a script

function func1 {
    echo "This is an example of a function"
}

count=1
while [ $count -le 5 ]
do
  func1
  count=$[ $count + 1 ] 
done

echo "This is the end of the loop"
func1
echo "Now, this is the end of the script"

wsx@wsx:~/tmp$ ./test1
This is an example of a function
This is an example of a function
This is an example of a function
This is an example of a function
This is an example of a function
This is the end of the loop
This is an example of a function
Now, this is the end of the script
```

注意，定义函数名`func1`的后面一定要跟`{`有空格隔开，不然会报错。**函数要先定义再使用，接触过编程的想必不陌生吧**。

### 返回值

bash shell会把函数当做一个小型脚本，运行结束时会返回一个退出状态码，有3种不同的方法来为函数生成退出状态码。

#### 默认退出状态码

默认函数的退出状态码是函数中最后一条命令返回的退出状态码。我们可以使用标准变量`$?`在函数执行结束后确定函数的状态码。

```shell
wsx@wsx:~/tmp$ cat test2
#!/bin/bash
# testing the exit status of a function

func1() {
	echo "trying to display a non-existent file"
	ls -l badfile
}

echo "testing the function"
func1
echo "The exit status is: $?"
wsx@wsx:~/tmp$ ./test2
testing the function
trying to display a non-existent file
ls: 无法访问'badfile': 没有那个文件或目录
The exit status is: 2
```

函数的退出状态码是2，说明函数的最后一条命令没有成功运行。但你无法知道函数中其他命令中是否成功运行，我们来看看下面一个例子。

```shell
wsx@wsx:~/tmp$ cat test3
#!/bin/bash
# testing the exit status of a function

func1(){
	ls -l badfile
	echo "This was a test of a bad command"
}

echo "testing the function:"
func1
echo "The exit status is: $?"
wsx@wsx:~/tmp$ ./test3
testing the function:
ls: 无法访问'badfile': 没有那个文件或目录
This was a test of a bad command
The exit status is: 0
```

这次函数的退出状态码是0，尽管其中有一条命令没有正常运行。可见使用函数的默认退出状态码是很危险的，幸运的是，我们有几种办法解决它。

### 使用return命令

